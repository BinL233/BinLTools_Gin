{"ast":null,"code":"import\"./userPage.css\";import React,{useEffect,useRef,useState}from'react';import\"./../../components/inputBox/inputBox.css\";import Header from\"../../components/header/header.js\";import Footer from\"../../components/footer/footer.js\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function UserPage(){const[userContent,setUserContent]=useState({});const[showModel,setShowModel]=useState(false);const[newUsername,setNewUsername]=useState('');const[message,setMessage]=useState(\"\");const userRef=useRef(null);function EditID(value){if(value.length<7){return\"0\".repeat(7-value.length)+value;}return value;}function handleChangeUsername(){setShowModel(true);}function handleCloseModal(){setShowModel(false);}async function handleSaveUsername(){try{var _response$headers$get;const response=await fetch('/api/user/change_username',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:new URLSearchParams({'user':newUsername})});if((_response$headers$get=response.headers.get('content-type'))!==null&&_response$headers$get!==void 0&&_response$headers$get.includes('application/json')){const data=await response.json();if(response.ok){console.log(\"username changed successful:\",data);setMessage(\"username changed successful\");window.location.href='/login';}else{console.error(\"username changed failed:\",data.msg);setMessage(data.msg||\"username changed failed due to unknown error.\");}}else{const text=await response.text();console.error(\"Unexpected response format:\",text);setMessage(\"An error occurred. Please try again later.\");}}catch(error){console.error('Error during login:',error);setMessage(\"An error occurred. Please try again later.\");}console.log('New username:',newUsername);setShowModel(false);}function error_notifier(){switch(message){case\"Invalid username format: The length of username only accepts 5 to 20\":userRef.current.style.boxShadow='0 2px 10px 2px #FF0056';break;case\"Invalid username format: Username only accepts letters, numbers and underline\":userRef.current.style.boxShadow='0 2px 10px 2px #FF0056';break;case\"Name exist\":userRef.current.style.boxShadow='0 2px 10px 2px #FF0056';break;default:break;}}function Logout(){fetch('/api/user/logout_process',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(response=>{if(response.ok){console.log('User logged out');window.location.href='/';}else{console.error('Logout failed');}}).catch(error=>{console.error('Error during logout:',error);});}useEffect(()=>{// Get login data from backend\nfetch('/api/user/login').then(response=>{if(!response.ok){throw new Error('Network response was not ok');}return response.json();}).then(data=>{console.log(\"Login data received:\",data);data.id=EditID(data.id);setUserContent(data);}).catch(error=>console.error('Error fetching data:',error));},[]);useEffect(()=>{error_notifier();},[message]);return/*#__PURE__*/_jsxs(\"div\",{className:\"user_page\",children:[/*#__PURE__*/_jsx(\"div\",{children:Header()}),/*#__PURE__*/_jsxs(\"div\",{className:\"main_container\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"user_name\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"xxlarge_text\",children:userContent.username}),/*#__PURE__*/_jsxs(\"p\",{className:\"medium_text\",children:[\"#\",userContent.id]})]}),/*#__PURE__*/_jsx(\"div\",{id:\"main_panel\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"info_container\",children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{className:\"info\",children:/*#__PURE__*/_jsx(\"button\",{className:\"change_name\",onClick:handleChangeUsername,children:\"Change User Name\"})}),/*#__PURE__*/_jsx(\"br\",{})]})}),/*#__PURE__*/_jsx(\"div\",{id:\"log_out\",children:/*#__PURE__*/_jsx(\"button\",{className:\"log_out\",type:\"button\",title:\"Logout\",onClick:Logout,children:\"Logout\"})})]}),/*#__PURE__*/_jsx(\"div\",{children:Footer()}),showModel&&/*#__PURE__*/_jsx(\"div\",{className:\"model\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"model_content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Change User Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newUsername,ref:userRef,onChange:e=>setNewUsername(e.target.value),placeholder:\"Enter new username\"}),/*#__PURE__*/_jsxs(\"div\",{id:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"change_name\",onClick:handleSaveUsername,children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{className:\"log_out\",onClick:handleCloseModal,children:\"Cancel\"})]})]})})]});}export default UserPage;","map":{"version":3,"names":["React","useEffect","useRef","useState","Header","Footer","jsx","_jsx","jsxs","_jsxs","UserPage","userContent","setUserContent","showModel","setShowModel","newUsername","setNewUsername","message","setMessage","userRef","EditID","value","length","repeat","handleChangeUsername","handleCloseModal","handleSaveUsername","_response$headers$get","response","fetch","method","headers","body","URLSearchParams","get","includes","data","json","ok","console","log","window","location","href","error","msg","text","error_notifier","current","style","boxShadow","Logout","then","catch","Error","id","className","children","username","onClick","type","title","ref","onChange","e","target","placeholder"],"sources":["/Users/kaileying/Documents/Repos/BinLTools_Gin/web/src/pages/userPage/userPage.js"],"sourcesContent":["import \"./userPage.css\"\nimport React, { useEffect, useRef, useState } from 'react';\nimport \"./../../components/inputBox/inputBox.css\"\nimport Header from \"../../components/header/header.js\"\nimport Footer from \"../../components/footer/footer.js\"\n\nfunction UserPage() {\n    const [userContent, setUserContent] = useState({});\n    const [showModel, setShowModel] = useState(false);\n    const [newUsername, setNewUsername] = useState('');\n    const [message, setMessage] = useState(\"\");\n    const userRef = useRef(null);\n\n    function EditID(value) {\n        if (value.length < 7) {\n            return \"0\".repeat(7 - value.length) + value;\n        }\n        return value;\n    }\n\n    function handleChangeUsername() {\n        setShowModel(true);\n    }\n\n    function handleCloseModal() {\n        setShowModel(false);\n    }\n\n\n    async function handleSaveUsername() {\n        try {\n            const response = await fetch('/api/user/change_username', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded',\n                },\n                body: new URLSearchParams({\n                    'user': newUsername,\n                })\n            });\n\n            if (response.headers.get('content-type')?.includes('application/json')) {\n                const data = await response.json();\n                if (response.ok) {\n                    console.log(\"username changed successful:\", data);\n                    setMessage(\"username changed successful\");\n                    window.location.href = '/login';\n                } else {\n                    console.error(\"username changed failed:\", data.msg);\n                    setMessage(data.msg || \"username changed failed due to unknown error.\");\n                }\n            } else {\n                const text = await response.text();\n                console.error(\"Unexpected response format:\", text);\n                setMessage(\"An error occurred. Please try again later.\");\n            }\n        } catch (error) {\n            console.error('Error during login:', error);\n            setMessage(\"An error occurred. Please try again later.\");\n        }\n\n        console.log('New username:', newUsername);\n        setShowModel(false);\n    }\n\n    function error_notifier() {\n        switch (message) {\n            case \"Invalid username format: The length of username only accepts 5 to 20\":\n                userRef.current.style.boxShadow = '0 2px 10px 2px #FF0056';\n                break;\n\n            case \"Invalid username format: Username only accepts letters, numbers and underline\":\n                userRef.current.style.boxShadow = '0 2px 10px 2px #FF0056';\n                break;\n\n            case \"Name exist\":\n                userRef.current.style.boxShadow = '0 2px 10px 2px #FF0056';\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    function Logout() {\n        fetch('/api/user/logout_process', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n            }\n        })\n\n        .then(response => {\n            if (response.ok) {\n                console.log('User logged out');\n                window.location.href = '/';\n            } else {\n                console.error('Logout failed');\n            }\n        })\n        .catch(error => {\n            console.error('Error during logout:', error);\n        });\n    }\n\n    useEffect(() => {\n        // Get login data from backend\n        fetch('/api/user/login')\n            .then(response => {\n                if (!response.ok) {\n                    throw new Error('Network response was not ok');\n                }\n                return response.json();\n            })\n            .then(data => {\n                console.log(\"Login data received:\", data);\n                data.id = EditID(data.id)\n                setUserContent(data);\n            })\n            .catch(error => console.error('Error fetching data:', error));\n    }, []);\n\n    useEffect(() => {\n        error_notifier();\n    }, [message]);\n\n    return (\n        <div className=\"user_page\">\n            {/* Import Header */}\n            <div>\n                { Header() }\n            </div>\n\n            <div className=\"main_container\">\n                <div id=\"user_name\">\n                    <p className=\"xxlarge_text\">{userContent.username}</p>\n                    <p className=\"medium_text\">#{userContent.id}</p>\n                </div>\n\n                <div id=\"main_panel\">\n                    <div className=\"info_container\">\n                        <br />\n                        <p className=\"info\">\n                            <button className=\"change_name\" onClick={handleChangeUsername}>\n                                Change User Name\n                            </button>\n                        </p>\n                        <br />\n                    </div>\n                </div>\n\n                <div id=\"log_out\">\n                    <button className=\"log_out\" type=\"button\" title=\"Logout\" onClick={Logout}>\n                        Logout\n                    </button>\n                </div>\n            </div>\n\n            {/* Import Footer */}\n            <div>\n                { Footer() }\n            </div>\n\n            {showModel && (\n                <div className=\"model\">\n                    <div className=\"model_content\">\n                        <h2>Change User Name</h2>\n                        <input\n                            type=\"text\"\n                            value={newUsername}\n                            ref={userRef}\n                            onChange={(e) => setNewUsername(e.target.value)}\n                            placeholder=\"Enter new username\"\n                        />\n                        <div id=\"buttons\">\n                            <button className=\"change_name\" onClick={handleSaveUsername}>Save</button>\n                            <button className=\"log_out\" onClick={handleCloseModal}>Cancel</button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default UserPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}